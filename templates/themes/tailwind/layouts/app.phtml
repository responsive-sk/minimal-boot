<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta name="description" content="<?= $e($description ?? 'Modern PHP framework built with Mezzio, featuring multiple frontend themes and clean architecture') ?>"/>
    <meta name="author" content="<?= $e($author ?? 'responsive.sk Team') ?>"/>
    <meta name="generator" content="Mezzio"/>
    <meta name="theme-color" content="#ffffff"/>
    <meta name="robots" content="index, follow"/>
    <meta name="keywords" content="PHP, Mezzio, Framework, Bootstrap, TailwindCSS, Modern Web Development"/>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="<?= $e($canonical ?? $_SERVER['REQUEST_URI'] ?? '') ?>"/>
    <meta property="og:title" content="<?= $e($title ?? 'Minimal Boot - Modern PHP Framework') ?>"/>
    <meta property="og:description" content="<?= $e($description ?? 'Modern PHP framework built with Mezzio, featuring multiple frontend themes and clean architecture') ?>"/>
    <meta property="og:site_name" content="Minimal Boot"/>

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image"/>
    <meta property="twitter:url" content="<?= $e($canonical ?? $_SERVER['REQUEST_URI'] ?? '') ?>"/>
    <meta property="twitter:title" content="<?= $e($title ?? 'Minimal Boot - Modern PHP Framework') ?>"/>
    <meta property="twitter:description" content="<?= $e($description ?? 'Modern PHP framework built with Mezzio, featuring multiple frontend themes and clean architecture') ?>"/>

    <!-- Canonical URL -->
    <link rel="canonical" href="<?= $e($canonical ?? $_SERVER['REQUEST_URI'] ?? '') ?>"/>

    <title><?= $e($title ?? 'Mezzio Light Application') ?></title>

    <link rel="apple-touch-icon" sizes="180x180" href="/images/app/favicon/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="/images/app/favicon/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="/images/app/favicon/favicon-16x16.png"/>
    <link rel="manifest" href="/images/app/favicon/site.webmanifest"/>
    <link rel="mask-icon" href="/images/app/favicon/safari-pinned-tab.svg" color="#5bbad5"/>
    <meta name="msapplication-TileColor" content="#da532c"/>

    <!-- Critical CSS moved to main CSS file -->

    <!-- Local fonts are now included in CSS bundle for better performance -->

    <?php
    // Determine CSS URL: explicit cssUrl > ThemeService > fallback
    if (isset($cssUrl)) {
        $finalCssUrl = $cssUrl;
    } elseif (isset($themeService)) {
        $finalCssUrl = $themeService->getThemeCssUrl();
    } else {
        $finalCssUrl = 'themes/main/assets/main.css';
    }
    ?>
    <!-- Load CSS synchronously to prevent FOUC -->
    <link rel="stylesheet" href="<?= $asset($finalCssUrl) ?>">

    <!-- Critical CSS moved to main CSS file -->
</head>

<body class="bg-gray-50 min-h-screen">
    <div class="min-h-screen flex flex-col">
        <!-- Navigation -->
        <nav class="bg-white shadow-sm border-b border-gray-200 fixed w-full top-0 z-40">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <a href="<?= $url('page::index') ?>" class="flex items-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded" aria-label="Go to homepage">
                            <img src="/images/app/logo.svg" class="h-8 w-auto" alt="Logo"/>
                        </a>
                    </div>

                    <!-- Desktop Navigation -->
                    <div class="hidden md:flex items-center space-x-8">
                        <div class="relative group">
                            <button class="text-gray-700 hover:text-blue-700 px-3 py-2 text-sm font-medium flex items-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded"
                                    data-dropdown-toggle="pages-dropdown"
                                    aria-label="Pages menu"
                                    aria-expanded="false"
                                    aria-haspopup="true">
                                Pages
                                <svg class="ml-1 h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                            <div id="pages-dropdown" class="dropdown-menu absolute left-0 mt-2 w-48 bg-white border border-gray-200 rounded-md shadow-lg transition-all duration-200 hidden z-50">
                                <a href="/page/about" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">About Us</a>
                                <a href="/page/privacy" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Privacy Policy</a>
                            </div>
                        </div>

                        <a href="https://github.com/responsive-sk/minimal-boot/" target="_blank" class="text-gray-700 hover:text-blue-700 px-3 py-2 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded">
                            GitHub
                        </a>

                        <a href="https://docs.dotkernel.org/light-documentation/" target="_blank" class="text-gray-700 hover:text-blue-700 px-3 py-2 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded">
                            Documentation
                        </a>

                        <div class="relative group">
                            <button class="text-gray-700 hover:text-blue-700 px-3 py-2 text-sm font-medium flex items-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded"
                                    data-dropdown-toggle="demos-dropdown"
                                    aria-label="Demos menu"
                                    aria-expanded="false"
                                    aria-haspopup="true">
                                Demos
                                <svg class="ml-1 h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                            <div id="demos-dropdown" class="dropdown-menu absolute left-0 mt-2 w-56 bg-white border border-gray-200 rounded-md shadow-lg transition-all duration-200 hidden z-50">
                                <a href="/demo" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                                    <span class="text-blue-600">ðŸŽ¨</span> TailwindCSS + Alpine.js
                                </a>
                                <a href="/demo/bootstrap" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                                    <span class="text-purple-600">âš¡</span> Bootstrap 5
                                </a>
                            </div>
                        </div>

                        <!-- Theme Selector -->
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-600">Theme:</span>
                            <div class="relative group">
                                <button id="themeDropdown" class="bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded-md text-sm hover:bg-gray-50 flex items-center"
                                        data-dropdown-toggle="theme-dropdown">
                                    <?php if (isset($themeService)): ?>
                                        <?php $themeConfig = $themeService->getCurrentThemeConfig(); ?>
                                        <?= $e($themeConfig['name']) ?>
                                    <?php else: ?>
                                        Tailwind CSS
                                    <?php endif; ?>
                                    <svg class="ml-1 h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                    </svg>
                                </button>
                                <div id="theme-dropdown" class="dropdown-menu absolute right-0 mt-2 w-64 bg-white border border-gray-200 rounded-md shadow-lg transition-all duration-200 hidden z-50">
                                    <?php
                                    if (isset($themeService)) {
                                        $availableThemes = $themeService->getAvailableThemes();
                                        $currentTheme = $themeService->getCurrentTheme();
                                    } else {
                                        $availableThemes = [
                                            'bootstrap' => ['name' => 'Bootstrap 5', 'description' => 'Modern Bootstrap 5 with custom styling'],
                                            'tailwind' => ['name' => 'Tailwind CSS', 'description' => 'Utility-first CSS framework with Alpine.js']
                                        ];
                                        $currentTheme = 'tailwind';
                                    }
                                    foreach ($availableThemes as $themeKey => $theme):
                                    ?>
                                        <a href="/theme/switch?theme=<?= $e($themeKey) ?>"
                                           data-theme="<?= $e($themeKey) ?>"
                                           class="theme-switch-link block px-4 py-3 text-sm hover:bg-gray-50 <?= $themeKey === $currentTheme ? 'bg-blue-50 text-blue-600' : 'text-gray-700' ?>">
                                            <div class="font-medium"><?= $e($theme['name']) ?></div>
                                            <div class="text-xs text-gray-500"><?= $e($theme['description']) ?></div>
                                        </a>
                                    <?php endforeach ?>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Mobile menu button -->
                    <div class="md:hidden flex items-center">
                        <button id="mobile-menu-button"
                                class="text-gray-700 hover:text-blue-600 p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                aria-label="Open mobile menu"
                                aria-expanded="false"
                                aria-controls="mobile-menu">
                            <span class="sr-only">Open main menu</span>
                            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Mobile menu -->
            <div id="mobile-menu" class="md:hidden hidden bg-white border-t border-gray-200">
                <div class="px-2 pt-2 pb-3 space-y-1">
                    <a href="/page/about" class="block px-3 py-2 text-gray-700 hover:text-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded">About Us</a>
                    <a href="/page/privacy" class="block px-3 py-2 text-gray-700 hover:text-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded">Privacy Policy</a>
                    <a href="https://github.com/responsive-sk/minimal-boot/" target="_blank" class="block px-3 py-2 text-gray-700 hover:text-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded">GitHub</a>
                    <a href="https://docs.dotkernel.org/light-documentation/" target="_blank" class="block px-3 py-2 text-gray-700 hover:text-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded">Documentation</a>
                    <a href="/demo" class="block px-3 py-2 text-gray-700 hover:text-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded">TailwindCSS Demo</a>
                    <a href="/demo/bootstrap" class="block px-3 py-2 text-gray-700 hover:text-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded">Bootstrap Demo</a>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 pt-16">
            <?= $content ?? '' ?>
        </main>

        <!-- Footer -->
        <footer class="bg-white border-t border-gray-200 mt-16">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="text-gray-600 text-sm">
                        &copy; <?= date('Y') ?> Mezzio Light Application. All rights reserved.
                    </div>
                    <div class="text-gray-600 text-sm mt-2 md:mt-0">
                        Powered by <a href="https://getmezzio.org/" target="_blank" class="text-blue-700 hover:text-blue-900 underline focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded">Mezzio</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <?php
    // Determine JS URL: explicit jsUrl > ThemeService > fallback
    $finalJsUrl = null;
    if (isset($jsUrl)) {
        $finalJsUrl = $jsUrl;
    } elseif (isset($themeService)) {
        $finalJsUrl = $themeService->getThemeJsUrl();
    } else {
        $finalJsUrl = 'themes/main/assets/main.js';
    }

    // Only load script if we have a valid JS URL
    if ($finalJsUrl !== null && $finalJsUrl !== ''): ?>
    <script defer src="<?= $asset($finalJsUrl) ?>"></script>
    <?php endif; ?>

    <!-- Theme switching functionality (handled by main.js) -->
</body>
</html>
